2024-04-09 19:37:03,059:INFO: Running experiment: NoRAG.
Saving all artifacts at /mnt/c/Users/QUAN/Desktop/lbp_mri/artifacts/gpt-4_NoRAG_09-04-2024-19-37
2024-04-09 19:37:03,059:INFO: -------------
Experiment settings:
description:NoRAG
n_iterations:3
dataset:data/queries/MSK LLM Fictitious Case Files Full.csv
json_testcases:data/queries/full_testcase.json
synthesizer_llm:gpt-4
synthesizer_max_tokens:512
synthesizer_temperature:0
2024-04-09 19:37:03,062:INFO: -------------
QA PROMPT: system: 
You are a radiologist expert at providing imaging recommendations for patients with musculoskeletal conditions.
If you do not know an answer, just say "I dont know", do not make up an answer.
==========
TASK: You are given a PATIENT PROFILE and a SCAN ORDER. Your task is to evaluate the appropriateness of the SCAN ORDER based on the PATIENT PROFILE.
Perform step-by-step the following sequence of reasoning.
1. Extract from PATIENT PROFILE relevant information for classification of imaging appropriateness. DO NOT make any assumptions from the SCAN ORDER.
Important information includes AGE, SYMPTOMS, PREVIOUS DIAGNOSIS (IF ANY), which stage of diagnosis (INITIAL IMAGING OR NEXT STUDY).
2. Identify if there are superior imaging procedures or treatments with a more favorable risk-benefit ratio.
3. Based on the SCORING CRITERIA, recommend if the SCAN ORDER is USUALLY APPROPRIATE, MAY BE APPROPRIATE, USUALLY NOT APPROPRIATE or there is INSUFFICIENT INFORMATION to recommend the appropriateness.  
If the scan is not appropriate, recommend an appropriate procedure.
==========
SCORING CRITERIA:
- USUALLY APPROPRIATE: The imaging procedure or treatment is indicated in the specified clinical scenarios at a favorable risk-benefit ratio for patients.
- MAY BE APPROPRIATE: The imaging procedure or treatment may be indicated in the specified clinical scenarios as an alternative to imaging procedures or treatments with a more favorable risk-benefit ratio, or the risk-benefit ratio for patients is equivocal.
- USUALLY NOT APPROPRIATE: The imaging procedure is unlikely to be recommended in the specified clinical scenarios, or the risk-benefit ratio for patients is likely to be unfavorable
- INSUFFICIENT INFORMATION: The imaging procedure or treatment is not mentioned under CONTEXT or not enough relevant information from the PATIENT PROFILE to recommend based on information in CONTEXT.

Take note for scenarios involving IV CONTRAST there are 3 distinct scan protocols: (1) with IV CONTRAST, (2) without IV CONTRAST, (3) without and with IV CONTRAST. 
Each of them is different and can have different appropriateness category.
==========

user: query_str
assistant: 
2024-04-09 19:37:03,070:INFO: ------START RUNNING TEST CASES---------
2024-04-09 19:37:03,070:INFO: Loading query file from path data/queries/MSK LLM Fictitious Case Files Full.csv
2024-04-09 19:37:03,097:INFO: Loading test cases from data/queries/full_testcase.json
2024-04-09 19:37:03,100:INFO: Iteration: 1
2024-04-09 19:52:13,730:INFO: --------------
Tokens Consumption: Total: 58310, Prompt: 39539, Completion: 18771, Embeddings: []
2024-04-09 19:52:13,731:INFO: ----------
Test case Completed. Saving Artifacts into /mnt/c/Users/QUAN/Desktop/lbp_mri/artifacts/gpt-4_NoRAG_09-04-2024-19-37
2024-04-09 19:53:05,579:INFO: ------EVALUATION-----
2024-04-09 19:53:05,579:INFO: Accuracy score: 42.25352112676056
2024-04-09 19:53:05,595:INFO: gpt_classification        human_gt                  match
INSUFFICIENT INFORMATION  INSUFFICIENT INFORMATION  True      1
MAY BE APPROPRIATE        INSUFFICIENT INFORMATION  False     2
                          MAY BE APPROPRIATE        True      5
                          USUALLY APPROPRIATE       False     1
                          USUALLY NOT APPROPRIATE   False    13
USUALLY APPROPRIATE       INSUFFICIENT INFORMATION  False     7
                          MAY BE APPROPRIATE        False     7
                          USUALLY APPROPRIATE       True     17
                          USUALLY NOT APPROPRIATE   False     7
USUALLY NOT APPROPRIATE   MAY BE APPROPRIATE        False     2
                          USUALLY APPROPRIATE       False     2
                          USUALLY NOT APPROPRIATE   True      7
Name: match, dtype: int64
2024-04-09 19:53:05,596:INFO: human_gt                  gpt_classification        match
INSUFFICIENT INFORMATION  INSUFFICIENT INFORMATION  True      1
                          MAY BE APPROPRIATE        False     2
                          USUALLY APPROPRIATE       False     7
MAY BE APPROPRIATE        MAY BE APPROPRIATE        True      5
                          USUALLY APPROPRIATE       False     7
                          USUALLY NOT APPROPRIATE   False     2
USUALLY APPROPRIATE       MAY BE APPROPRIATE        False     1
                          USUALLY APPROPRIATE       True     17
                          USUALLY NOT APPROPRIATE   False     2
USUALLY NOT APPROPRIATE   MAY BE APPROPRIATE        False    13
                          USUALLY APPROPRIATE       False     7
                          USUALLY NOT APPROPRIATE   True      7
Name: match, dtype: int64
2024-04-09 19:53:05,596:INFO: Iteration: 2
2024-04-09 20:08:33,947:INFO: --------------
Tokens Consumption: Total: 116427, Prompt: 79078, Completion: 37349, Embeddings: []
2024-04-09 20:08:33,947:INFO: ----------
Test case Completed. Saving Artifacts into /mnt/c/Users/QUAN/Desktop/lbp_mri/artifacts/gpt-4_NoRAG_09-04-2024-19-37
2024-04-09 20:09:24,559:INFO: ------EVALUATION-----
2024-04-09 20:09:24,560:INFO: Accuracy score: 40.845070422535215
2024-04-09 20:09:24,565:INFO: gpt_classification       human_gt                  match
MAY BE APPROPRIATE       INSUFFICIENT INFORMATION  False     2
                         MAY BE APPROPRIATE        True      2
                         USUALLY APPROPRIATE       False     1
                         USUALLY NOT APPROPRIATE   False     7
USUALLY APPROPRIATE      INSUFFICIENT INFORMATION  False     7
                         MAY BE APPROPRIATE        False    10
                         USUALLY APPROPRIATE       True     17
                         USUALLY NOT APPROPRIATE   False    10
USUALLY NOT APPROPRIATE  INSUFFICIENT INFORMATION  False     1
                         MAY BE APPROPRIATE        False     2
                         USUALLY APPROPRIATE       False     2
                         USUALLY NOT APPROPRIATE   True     10
Name: match, dtype: int64
2024-04-09 20:09:24,569:INFO: human_gt                  gpt_classification       match
INSUFFICIENT INFORMATION  MAY BE APPROPRIATE       False     2
                          USUALLY APPROPRIATE      False     7
                          USUALLY NOT APPROPRIATE  False     1
MAY BE APPROPRIATE        MAY BE APPROPRIATE       True      2
                          USUALLY APPROPRIATE      False    10
                          USUALLY NOT APPROPRIATE  False     2
USUALLY APPROPRIATE       MAY BE APPROPRIATE       False     1
                          USUALLY APPROPRIATE      True     17
                          USUALLY NOT APPROPRIATE  False     2
USUALLY NOT APPROPRIATE   MAY BE APPROPRIATE       False     7
                          USUALLY APPROPRIATE      False    10
                          USUALLY NOT APPROPRIATE  True     10
Name: match, dtype: int64
2024-04-09 20:09:24,570:INFO: Iteration: 3
2024-04-09 20:25:01,506:INFO: --------------
Tokens Consumption: Total: 174770, Prompt: 118617, Completion: 56153, Embeddings: []
2024-04-09 20:25:01,507:INFO: ----------
Test case Completed. Saving Artifacts into /mnt/c/Users/QUAN/Desktop/lbp_mri/artifacts/gpt-4_NoRAG_09-04-2024-19-37
2024-04-09 21:42:01,338:INFO: ------EVALUATION-----
2024-04-09 21:42:01,338:INFO: Accuracy score: 42.25352112676056
2024-04-09 21:42:01,340:INFO: gpt_classification       human_gt                  match
MAY BE APPROPRIATE       INSUFFICIENT INFORMATION  False     1
                         MAY BE APPROPRIATE        True      4
                         USUALLY APPROPRIATE       False     1
                         USUALLY NOT APPROPRIATE   False    10
USUALLY APPROPRIATE      INSUFFICIENT INFORMATION  False     7
                         MAY BE APPROPRIATE        False    10
                         USUALLY APPROPRIATE       True     17
                         USUALLY NOT APPROPRIATE   False     8
USUALLY NOT APPROPRIATE  INSUFFICIENT INFORMATION  False     2
                         USUALLY APPROPRIATE       False     2
                         USUALLY NOT APPROPRIATE   True      9
Name: match, dtype: int64
2024-04-09 21:42:01,342:INFO: human_gt                  gpt_classification       match
INSUFFICIENT INFORMATION  MAY BE APPROPRIATE       False     1
                          USUALLY APPROPRIATE      False     7
                          USUALLY NOT APPROPRIATE  False     2
MAY BE APPROPRIATE        MAY BE APPROPRIATE       True      4
                          USUALLY APPROPRIATE      False    10
USUALLY APPROPRIATE       MAY BE APPROPRIATE       False     1
                          USUALLY APPROPRIATE      True     17
                          USUALLY NOT APPROPRIATE  False     2
USUALLY NOT APPROPRIATE   MAY BE APPROPRIATE       False    10
                          USUALLY APPROPRIATE      False     8
                          USUALLY NOT APPROPRIATE  True      9
Name: match, dtype: int64
